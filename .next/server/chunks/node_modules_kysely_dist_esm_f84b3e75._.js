module.exports=[59094,e=>{"use strict";function t(e){return void 0===e||void 0===e}function i(e){return"string"==typeof e}function r(e){return"number"==typeof e}function o(e){return"boolean"==typeof e}function n(e){return null===e}function s(e){return e instanceof Date}function d(e){return"bigint"==typeof e}function a(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)}function h(e){return"function"==typeof e}function p(e){return"object"==typeof e&&null!==e}function u(e){return e[e.length-1]}function l(e){return Object.freeze(e)}function c(e){return N(e)?e:[e]}function N(e){return Array.isArray(e)}function f(e){return e}e.s(["asArray",()=>c,"freeze",()=>l,"getLast",()=>u,"isBigInt",()=>d,"isBoolean",()=>o,"isBuffer",()=>a,"isDate",()=>s,"isFunction",()=>h,"isNull",()=>n,"isNumber",()=>r,"isObject",()=>p,"isReadonlyArray",()=>N,"isString",()=>i,"isUndefined",()=>t,"noop",()=>f]),Object.prototype.toString},90870,66065,9445,16032,57878,e=>{"use strict";e.s(["FromNode",()=>i],90870);var t=e.i(59094);let i=(0,t.freeze)({is:e=>"FromNode"===e.kind,create:e=>(0,t.freeze)({kind:"FromNode",froms:(0,t.freeze)(e)}),cloneWithFroms:(e,i)=>(0,t.freeze)({...e,froms:(0,t.freeze)([...e.froms,...i])})});e.s(["GroupByNode",()=>r],66065);let r=(0,t.freeze)({is:e=>"GroupByNode"===e.kind,create:e=>(0,t.freeze)({kind:"GroupByNode",items:(0,t.freeze)(e)}),cloneWithItems:(e,i)=>(0,t.freeze)({...e,items:(0,t.freeze)([...e.items,...i])})});e.s(["HavingNode",()=>s],57878),e.s(["AndNode",()=>o],9445);let o=(0,t.freeze)({is:e=>"AndNode"===e.kind,create:(e,i)=>(0,t.freeze)({kind:"AndNode",left:e,right:i})});e.s(["OrNode",()=>n],16032);let n=(0,t.freeze)({is:e=>"OrNode"===e.kind,create:(e,i)=>(0,t.freeze)({kind:"OrNode",left:e,right:i})}),s=(0,t.freeze)({is:e=>"HavingNode"===e.kind,create:e=>(0,t.freeze)({kind:"HavingNode",having:e}),cloneWithOperation:(e,i,r)=>(0,t.freeze)({...e,having:"And"===i?o.create(e.having,r):n.create(e.having,r)})})},80182,e=>{"use strict";e.s(["InsertQueryNode",()=>i]);var t=e.i(59094);let i=(0,t.freeze)({is:e=>"InsertQueryNode"===e.kind,create:(e,i,r)=>(0,t.freeze)({kind:"InsertQueryNode",into:e,...i&&{with:i},replace:r}),createWithoutInto:()=>(0,t.freeze)({kind:"InsertQueryNode"}),cloneWith:(e,i)=>(0,t.freeze)({...e,...i})})},92868,36519,88758,91889,10636,2423,91494,69565,e=>{"use strict";e.s(["QueryNode",()=>w],92868);var t=e.i(80182),i=e.i(19254);e.s(["UpdateQueryNode",()=>s],88758);var r=e.i(59094),o=e.i(90870);e.s(["ListNode",()=>n],36519);let n=(0,r.freeze)({is:e=>"ListNode"===e.kind,create:e=>(0,r.freeze)({kind:"ListNode",items:(0,r.freeze)(e)})}),s=(0,r.freeze)({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"UpdateQueryNode",table:1===e.length?e[0]:n.create(e),...t&&{with:t}}),createWithoutTable:()=>(0,r.freeze)({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>(0,r.freeze)({...e,from:e.from?o.FromNode.cloneWithFroms(e.from,t):o.FromNode.create(t)}),cloneWithUpdates:(e,t)=>(0,r.freeze)({...e,updates:e.updates?(0,r.freeze)([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>(0,r.freeze)({...e,limit:t})});e.s(["DeleteQueryNode",()=>a],91889);let d=(0,r.freeze)({is:e=>"UsingNode"===e.kind,create:e=>(0,r.freeze)({kind:"UsingNode",tables:(0,r.freeze)(e)}),cloneWithTables:(e,t)=>(0,r.freeze)({...e,tables:(0,r.freeze)([...e.tables,...t])})}),a=(0,r.freeze)({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"DeleteQueryNode",from:o.FromNode.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>w.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>w.cloneWithoutOrderBy(e),cloneWithLimit:(e,t)=>(0,r.freeze)({...e,limit:t}),cloneWithoutLimit:e=>(0,r.freeze)({...e,limit:void 0}),cloneWithUsing:(e,t)=>(0,r.freeze)({...e,using:void 0!==e.using?d.cloneWithTables(e.using,t):d.create(t)})});e.s(["WhereNode",()=>u],10636);var h=e.i(9445),p=e.i(16032);let u=(0,r.freeze)({is:e=>"WhereNode"===e.kind,create:e=>(0,r.freeze)({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,i)=>(0,r.freeze)({...e,where:"And"===t?h.AndNode.create(e.where,i):p.OrNode.create(e.where,i)})}),l=(0,r.freeze)({is:e=>"ReturningNode"===e.kind,create:e=>(0,r.freeze)({kind:"ReturningNode",selections:(0,r.freeze)(e)}),cloneWithSelections:(e,t)=>(0,r.freeze)({...e,selections:e.selections?(0,r.freeze)([...e.selections,...t]):(0,r.freeze)(t)})}),c=(0,r.freeze)({is:e=>"ExplainNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"ExplainNode",format:e,options:t})});e.s(["MergeQueryNode",()=>f],91494),e.s(["WhenNode",()=>N],2423);let N=(0,r.freeze)({is:e=>"WhenNode"===e.kind,create:e=>(0,r.freeze)({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>(0,r.freeze)({...e,result:t})}),f=(0,r.freeze)({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>(0,r.freeze)({...e,using:t}),cloneWithWhen:(e,t)=>(0,r.freeze)({...e,whens:e.whens?(0,r.freeze)([...e.whens,t]):(0,r.freeze)([t])}),cloneWithThen:(e,t)=>(0,r.freeze)({...e,whens:e.whens?(0,r.freeze)([...e.whens.slice(0,-1),N.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),m=(0,r.freeze)({is:e=>"OutputNode"===e.kind,create:e=>(0,r.freeze)({kind:"OutputNode",selections:(0,r.freeze)(e)}),cloneWithSelections:(e,t)=>(0,r.freeze)({...e,selections:e.selections?(0,r.freeze)([...e.selections,...t]):(0,r.freeze)(t)})});e.s(["OrderByNode",()=>y],69565);let y=(0,r.freeze)({is:e=>"OrderByNode"===e.kind,create:e=>(0,r.freeze)({kind:"OrderByNode",items:(0,r.freeze)([...e])}),cloneWithItems:(e,t)=>(0,r.freeze)({...e,items:(0,r.freeze)([...e.items,...t])})}),w=(0,r.freeze)({is:e=>i.SelectQueryNode.is(e)||t.InsertQueryNode.is(e)||s.is(e)||a.is(e)||f.is(e),cloneWithEndModifier:(e,t)=>(0,r.freeze)({...e,endModifiers:e.endModifiers?(0,r.freeze)([...e.endModifiers,t]):(0,r.freeze)([t])}),cloneWithWhere:(e,t)=>(0,r.freeze)({...e,where:e.where?u.cloneWithOperation(e.where,"And",t):u.create(t)}),cloneWithJoin:(e,t)=>(0,r.freeze)({...e,joins:e.joins?(0,r.freeze)([...e.joins,t]):(0,r.freeze)([t])}),cloneWithReturning:(e,t)=>(0,r.freeze)({...e,returning:e.returning?l.cloneWithSelections(e.returning,t):l.create(t)}),cloneWithoutReturning:e=>(0,r.freeze)({...e,returning:void 0}),cloneWithoutWhere:e=>(0,r.freeze)({...e,where:void 0}),cloneWithExplain:(e,t,i)=>(0,r.freeze)({...e,explain:c.create(t,i?.toOperationNode())}),cloneWithTop:(e,t)=>(0,r.freeze)({...e,top:t}),cloneWithOutput:(e,t)=>(0,r.freeze)({...e,output:e.output?m.cloneWithSelections(e.output,t):m.create(t)}),cloneWithOrderByItems:(e,t)=>(0,r.freeze)({...e,orderBy:e.orderBy?y.cloneWithItems(e.orderBy,t):y.create(t)}),cloneWithoutOrderBy:e=>(0,r.freeze)({...e,orderBy:void 0})})},19254,e=>{"use strict";e.s(["SelectQueryNode",()=>s]);var t=e.i(59094),i=e.i(90870),r=e.i(66065),o=e.i(57878),n=e.i(92868);let s=(0,t.freeze)({is:e=>"SelectQueryNode"===e.kind,create:e=>(0,t.freeze)({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,r)=>(0,t.freeze)({kind:"SelectQueryNode",from:i.FromNode.create(e),...r&&{with:r}}),cloneWithSelections:(e,i)=>(0,t.freeze)({...e,selections:e.selections?(0,t.freeze)([...e.selections,...i]):(0,t.freeze)(i)}),cloneWithDistinctOn:(e,i)=>(0,t.freeze)({...e,distinctOn:e.distinctOn?(0,t.freeze)([...e.distinctOn,...i]):(0,t.freeze)(i)}),cloneWithFrontModifier:(e,i)=>(0,t.freeze)({...e,frontModifiers:e.frontModifiers?(0,t.freeze)([...e.frontModifiers,i]):(0,t.freeze)([i])}),cloneWithOrderByItems:(e,t)=>n.QueryNode.cloneWithOrderByItems(e,t),cloneWithGroupByItems:(e,i)=>(0,t.freeze)({...e,groupBy:e.groupBy?r.GroupByNode.cloneWithItems(e.groupBy,i):r.GroupByNode.create(i)}),cloneWithLimit:(e,i)=>(0,t.freeze)({...e,limit:i}),cloneWithOffset:(e,i)=>(0,t.freeze)({...e,offset:i}),cloneWithFetch:(e,i)=>(0,t.freeze)({...e,fetch:i}),cloneWithHaving:(e,i)=>(0,t.freeze)({...e,having:e.having?o.HavingNode.cloneWithOperation(e.having,"And",i):o.HavingNode.create(i)}),cloneWithSetOperations:(e,i)=>(0,t.freeze)({...e,setOperations:e.setOperations?(0,t.freeze)([...e.setOperations,...i]):(0,t.freeze)([...i])}),cloneWithoutSelections:e=>(0,t.freeze)({...e,selections:[]}),cloneWithoutLimit:e=>(0,t.freeze)({...e,limit:void 0}),cloneWithoutOffset:e=>(0,t.freeze)({...e,offset:void 0}),cloneWithoutOrderBy:e=>n.QueryNode.cloneWithoutOrderBy(e),cloneWithoutGroupBy:e=>(0,t.freeze)({...e,groupBy:void 0})})},61761,e=>{"use strict";e.s(["IdentifierNode",()=>i]);var t=e.i(59094);let i=(0,t.freeze)({is:e=>"IdentifierNode"===e.kind,create:e=>(0,t.freeze)({kind:"IdentifierNode",name:e})})},90476,1765,18728,26951,69972,e=>{"use strict";e.s(["CompiledQuery",()=>d],90476),e.s(["RawNode",()=>i],1765);var t=e.i(59094);let i=(0,t.freeze)({is:e=>"RawNode"===e.kind,create:(e,i)=>(0,t.freeze)({kind:"RawNode",sqlFragments:(0,t.freeze)(e),parameters:(0,t.freeze)(i)}),createWithSql:e=>i.create([e],[]),createWithChild:e=>i.create(["",""],[e]),createWithChildren:e=>i.create(Array(e.length+1).fill(""),e)});e.s(["createQueryId",()=>n],26951),e.s(["randomString",()=>o],18728);let r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function o(e){let t="";for(let i=0;i<e;++i)t+=r[~~(Math.random()*r.length)];return t}function n(){return new s}class s{#e;get queryId(){return void 0===this.#e&&(this.#e=o(8)),this.#e}}let d=(0,t.freeze)({raw:(e,r=[])=>(0,t.freeze)({sql:e,query:i.createWithSql(e),parameters:(0,t.freeze)(r),queryId:n()})});e.s(["CreateTableNode",()=>h,"ON_COMMIT_ACTIONS",()=>a],69972);let a=["preserve rows","delete rows","drop"],h=(0,t.freeze)({is:e=>"CreateTableNode"===e.kind,create:e=>(0,t.freeze)({kind:"CreateTableNode",table:e,columns:(0,t.freeze)([])}),cloneWithColumn:(e,i)=>(0,t.freeze)({...e,columns:(0,t.freeze)([...e.columns,i])}),cloneWithConstraint:(e,i)=>(0,t.freeze)({...e,constraints:e.constraints?(0,t.freeze)([...e.constraints,i]):(0,t.freeze)([i])}),cloneWithFrontModifier:(e,i)=>(0,t.freeze)({...e,frontModifiers:e.frontModifiers?(0,t.freeze)([...e.frontModifiers,i]):(0,t.freeze)([i])}),cloneWithEndModifier:(e,i)=>(0,t.freeze)({...e,endModifiers:e.endModifiers?(0,t.freeze)([...e.endModifiers,i]):(0,t.freeze)([i])}),cloneWith:(e,i)=>(0,t.freeze)({...e,...i})})},83849,9753,88986,e=>{"use strict";e.s(["OperationNodeVisitor",()=>i],83849);var t=e.i(59094);class i{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#t=(0,t.freeze)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#t[e.kind](e),this.nodeStack.pop()}}e.s(["OPERATORS",()=>o,"OperatorNode",()=>n,"isJSONOperator",()=>s],9753);let r=["->","->>"],o=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...r,"not","-","exists","not exists","between","between symmetric"],n=(0,t.freeze)({is:e=>"OperatorNode"===e.kind,create:e=>(0,t.freeze)({kind:"OperatorNode",operator:e})});function s(e){return(0,t.isString)(e)&&r.includes(e)}e.s(["ParensNode",()=>d],88986);let d=(0,t.freeze)({is:e=>"ParensNode"===e.kind,create:e=>(0,t.freeze)({kind:"ParensNode",node:e})})},36306,66586,78655,68599,36300,99948,77033,44473,4196,81196,44550,93846,54996,70445,26015,92465,86474,46599,52564,78800,25176,2757,91658,75670,69918,58390,13031,e=>{"use strict";e.s(["DefaultQueryCompiler",()=>m],36306);var t=e.i(69972),i=e.i(80182),r=e.i(83849),o=e.i(9753),n=e.i(88986),s=e.i(92868),d=e.i(59094);e.s(["CreateViewNode",()=>p],78655),e.s(["SchemableIdentifierNode",()=>h],66586);var a=e.i(61761);let h=(0,d.freeze)({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>(0,d.freeze)({kind:"SchemableIdentifierNode",identifier:a.IdentifierNode.create(e)}),createWithSchema:(e,t)=>(0,d.freeze)({kind:"SchemableIdentifierNode",schema:a.IdentifierNode.create(e),identifier:a.IdentifierNode.create(t)})}),p=(0,d.freeze)({is:e=>"CreateViewNode"===e.kind,create:e=>(0,d.freeze)({kind:"CreateViewNode",name:h.create(e)}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t})}),u=(0,d.freeze)({is:e=>"SetOperationNode"===e.kind,create:(e,t,i)=>(0,d.freeze)({kind:"SetOperationNode",operator:e,expression:t,all:i})});var l=e.i(91494);e.s(["logOnce",()=>N],68599);let c=new Set;function N(e){c.has(e)||(c.add(e),console.log(e))}let f=/'/g;class m extends r.OperationNodeVisitor{#i="";#r=[];get numParameters(){return this.#r.length}compileQuery(e,t){return this.#i="",this.#r=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),(0,d.freeze)({query:e,queryId:t,sql:this.getSql(),parameters:[...this.#r]})}getSql(){return this.#i}visitSelectQuery(e){let r=void 0!==this.parentNode&&!n.ParensNode.is(this.parentNode)&&!i.InsertQueryNode.is(this.parentNode)&&!t.CreateTableNode.is(this.parentNode)&&!p.is(this.parentNode)&&!u.is(this.parentNode);void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),r&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){let i=e.length-1;for(let r=0;r<=i;r++)this.visitNode(e[r]),r<i&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){let t=this.nodeStack.find(s.QueryNode.is),i=t!==e;!i&&e.explain&&(this.visitNode(e.explain),this.append(" ")),i&&!l.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&(N("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),e.orAction&&(this.append(" "),this.visitNode(e.orAction)),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),i&&!l.MergeQueryNode.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){let t=this.nodeStack.find(s.QueryNode.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!(0,d.isString)(e.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");let{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(g[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:t,parameters:i}=e;for(let e=0;e<t.length;++e)this.append(t[e]),i.length>e&&this.visitNode(i[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.collation&&(this.append(" "),this.visitNode(e.collation)),e.direction&&(this.append(" "),this.visitNode(e.direction)),e.nulls&&(this.append(" nulls "),this.append(e.nulls))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let t=this.nodeStack.find(s.QueryNode.is),i=t!==e;if(!i&&e.explain&&(this.visitNode(e.explain),this.append(" ")),i&&!l.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins){if(!e.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(e.joins," ")}e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),i&&!l.MergeQueryNode.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}buildDeferrable(e){void 0!==e.deferrable&&(e.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==e.initiallyDeferred&&(e.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate)),this.buildDeferrable(e)}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),(0,d.isBoolean)(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.renameConstraint&&this.visitNode(e.renameConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitRenameConstraint(e){this.append("rename constraint "),this.visitNode(e.oldName),this.append(" to "),this.visitNode(e.newName)}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitRefreshMaterializedView(e){this.append("refresh materialized view "),e.concurrently&&this.append("concurrently "),this.visitNode(e.name),e.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(y[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),this.append(")"),e.withinGroup&&(this.append(" within group ("),this.visitNode(e.withinGroup),this.append(")")),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return o.OperatorNode.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){for(let t of(e.inOperator&&this.visitNode(e.inOperator),this.append("'$"),e.pathLegs))this.visitNode(t);this.append("'")}visitJSONPathLeg(e){let t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,i=e.values.length;t<i;t++)t===i-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.returning&&(this.append(" "),this.visitNode(e.returning)),e.output&&(this.append(" "),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}visitOrAction(e){this.append(e.action)}visitCollate(e){this.append("collate "),this.visitNode(e.collation)}append(e){this.#i+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){let t=this.getLeftIdentifierWrapper(),i=this.getRightIdentifierWrapper(),r="";for(let o of e)r+=o,o===t?r+=t:o===i&&(r+=i);return r}sanitizeStringLiteral(e){return e.replace(f,"''")}addParameter(e){this.#r.push(e)}appendImmediateValue(e){if((0,d.isString)(e))this.appendStringLiteral(e);else if((0,d.isNumber)(e)||(0,d.isBoolean)(e)||(0,d.isBigInt)(e))this.append(e.toString());else if((0,d.isNull)(e))this.append("null");else if((0,d.isDate)(e))this.appendImmediateValue(e.toISOString());else throw Error(`invalid immediate value ${e}`)}appendStringLiteral(e){this.append("'"),this.append(this.sanitizeStringLiteral(e)),this.append("'")}sortSelectModifiers(e){return e.sort((e,t)=>e.modifier&&t.modifier?w[e.modifier]-w[t.modifier]:1),(0,d.freeze)(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}let y=(0,d.freeze)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),w=(0,d.freeze)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),g=(0,d.freeze)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"});e.s(["DEFAULT_MIGRATION_LOCK_TABLE",()=>B,"DEFAULT_MIGRATION_TABLE",()=>T],77033),e.s(["WithSchemaPlugin",()=>Q],99948);let v=(0,d.freeze)({is:e=>"AliasNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"AliasNode",node:e,alias:t})});var b=e.i(9445),O=e.i(16032);let W=(0,d.freeze)({is:e=>"OnNode"===e.kind,create:e=>(0,d.freeze)({kind:"OnNode",on:e}),cloneWithOperation:(e,t,i)=>(0,d.freeze)({...e,on:"And"===t?b.AndNode.create(e.on,i):O.OrNode.create(e.on,i)})}),x=(0,d.freeze)({is:e=>"JoinNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,i)=>(0,d.freeze)({kind:"JoinNode",joinType:e,table:t,on:W.create(i)}),cloneWithOn:(e,t)=>(0,d.freeze)({...e,on:e.on?W.cloneWithOperation(e.on,"And",t):W.create(t)})});var z=e.i(36519);e.s(["OperationNodeTransformer",()=>C],36300);class C{nodeStack=[];#o=(0,d.freeze)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(e,t){if(!e)return e;this.nodeStack.push(e);let i=this.transformNodeImpl(e,t);return this.nodeStack.pop(),(0,d.freeze)(i)}transformNodeImpl(e,t){return this.#o[e.kind](e,t)}transformNodeList(e,t){return e?(0,d.freeze)(e.map(e=>this.transformNode(e,t))):e}transformSelectQuery(e,t){return{kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)}}transformSelection(e,t){return{kind:"SelectionNode",selection:this.transformNode(e.selection,t)}}transformColumn(e,t){return{kind:"ColumnNode",column:this.transformNode(e.column,t)}}transformAlias(e,t){return{kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)}}transformTable(e,t){return{kind:"TableNode",table:this.transformNode(e.table,t)}}transformFrom(e,t){return{kind:"FromNode",froms:this.transformNodeList(e.froms,t)}}transformReference(e,t){return{kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)}}transformAnd(e,t){return{kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformOr(e,t){return{kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformValueList(e,t){return{kind:"ValueListNode",values:this.transformNodeList(e.values,t)}}transformParens(e,t){return{kind:"ParensNode",node:this.transformNode(e.node,t)}}transformJoin(e,t){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)}}transformRaw(e,t){return{kind:"RawNode",sqlFragments:(0,d.freeze)([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)}}transformWhere(e,t){return{kind:"WhereNode",where:this.transformNode(e.where,t)}}transformInsertQuery(e,t){return{kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformValues(e,t){return{kind:"ValuesNode",values:this.transformNodeList(e.values,t)}}transformDeleteQuery(e,t){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformReturning(e,t){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)}}transformCreateTable(e,t){return{kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)}}transformColumnDefinition(e,t){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,t){return{kind:"AddColumnNode",column:this.transformNode(e.column,t)}}transformDropTable(e,t){return{kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,t){return{kind:"OrderByNode",items:this.transformNodeList(e.items,t)}}transformOrderByItem(e,t){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls}}transformGroupBy(e,t){return{kind:"GroupByNode",items:this.transformNodeList(e.items,t)}}transformGroupByItem(e,t){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)}}transformUpdateQuery(e,t){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)}}transformColumnUpdate(e,t){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)}}transformLimit(e,t){return{kind:"LimitNode",limit:this.transformNode(e.limit,t)}}transformOffset(e,t){return{kind:"OffsetNode",offset:this.transformNode(e.offset,t)}}transformOnConflict(e,t){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing}}transformOnDuplicateKey(e,t){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)}}transformCreateIndex(e,t){return{kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,t){return{kind:"ListNode",items:this.transformNodeList(e.items,t)}}transformDropIndex(e,t){return{kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,t){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,t){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,t){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,t){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all}}transformReferences(e,t){return{kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,t){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)}}transformWith(e,t){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive}}transformCommonTableExpression(e,t){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)}}transformCommonTableExpressionName(e,t){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)}}transformHaving(e,t){return{kind:"HavingNode",having:this.transformNode(e.having,t)}}transformCreateSchema(e,t){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists}}transformDropSchema(e,t){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,t){return{kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)}}transformDropColumn(e,t){return{kind:"DropColumnNode",column:this.transformNode(e.column,t)}}transformRenameColumn(e,t){return{kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)}}transformAlterColumn(e,t){return{kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,t){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,t)}}transformAddConstraint(e,t){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)}}transformDropConstraint(e,t){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,t){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)}}transformCreateView(e,t){return{kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)}}transformRefreshMaterializedView(e,t){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,t){return{kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,t){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)}}transformDefaultValue(e,t){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)}}transformOn(e,t){return{kind:"OnNode",on:this.transformNode(e.on,t)}}transformSelectModifier(e,t){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)}}transformCreateType(e,t){return{kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)}}transformDropType(e,t){return{kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists}}transformExplain(e,t){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)}}transformSchemableIdentifier(e,t){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)}}transformAggregateFunction(e,t){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)}}transformOver(e,t){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)}}transformPartitionBy(e,t){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,t)}}transformPartitionByItem(e,t){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)}}transformBinaryOperation(e,t){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)}}transformUnaryOperation(e,t){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)}}transformUsing(e,t){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,t)}}transformFunction(e,t){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)}}transformCase(e,t){return{kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement}}transformWhen(e,t){return{kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)}}transformJSONReference(e,t){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)}}transformJSONPath(e,t){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)}}transformJSONPathLeg(e,t){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,t){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)}}transformTuple(e,t){return{kind:"TupleNode",values:this.transformNodeList(e.values,t)}}transformMergeQuery(e,t){return{kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)}}transformMatched(e,t){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,t){return{kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists}}transformCast(e,t){return{kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)}}transformFetch(e,t){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier}}transformTop(e,t){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,t){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,t)}}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}let q=(0,d.freeze)({is:e=>"TableNode"===e.kind,create:e=>(0,d.freeze)({kind:"TableNode",table:h.create(e)}),createWithSchema:(e,t)=>(0,d.freeze)({kind:"TableNode",table:h.createWithSchema(e,t)})}),k=(0,d.freeze)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),I={json_agg:!0,to_json:!0};class S extends C{#n;#s=new Set;#d=new Set;constructor(e){super(),this.#n=e}transformNodeImpl(e,t){if(!this.#a(e))return super.transformNodeImpl(e,t);let i=this.#h(e);for(let e of i)this.#d.add(e);let r=this.#p(e);for(let e of r)this.#s.add(e);let o=super.transformNodeImpl(e,t);for(let e of r)this.#s.delete(e);for(let e of i)this.#d.delete(e);return o}transformSchemableIdentifier(e,t){let i=super.transformSchemableIdentifier(e,t);return i.schema||!this.#s.has(e.identifier.name)?i:{...i,schema:a.IdentifierNode.create(this.#n)}}transformReferences(e,t){let i=super.transformReferences(e,t);return i.table.table.schema?i:{...i,table:q.createWithSchema(this.#n,i.table.table.identifier.name)}}transformAggregateFunction(e,t){return{...super.transformAggregateFunction({...e,aggregated:[]},t),aggregated:this.#u(e,t,"aggregated")}}transformFunction(e,t){return{...super.transformFunction({...e,arguments:[]},t),arguments:this.#u(e,t,"arguments")}}#u(e,t,i){return I[e.func]?e[i].map(e=>!q.is(e)||e.table.schema?this.transformNode(e,t):{...e,table:this.transformIdentifier(e.table.identifier,t)}):this.transformNodeList(e[i],t)}#a(e){return e.kind in k}#p(e){let t=new Set;if("name"in e&&e.name&&h.is(e.name)&&this.#l(e.name,t),"from"in e&&e.from)for(let i of e.from.froms)this.#c(i,t);if("into"in e&&e.into&&this.#c(e.into,t),"table"in e&&e.table&&this.#c(e.table,t),"joins"in e&&e.joins)for(let i of e.joins)this.#c(i.table,t);return"using"in e&&e.using&&(x.is(e.using)?this.#c(e.using.table,t):this.#c(e.using,t)),t}#h(e){let t=new Set;return"with"in e&&e.with&&this.#N(e.with,t),t}#c(e,t){if(q.is(e))this.#l(e.table,t);else if(v.is(e)&&q.is(e.node))this.#l(e.node.table,t);else if(z.ListNode.is(e))for(let i of e.items)this.#c(i,t)}#l(e,t){let i=e.identifier.name;this.#s.has(i)||this.#d.has(i)||t.add(i)}#N(e,t){for(let i of e.expressions){let e=i.name.table.table.identifier.name;this.#d.has(e)||t.add(e)}}}class Q{#f;constructor(e){this.#f=new S(e)}transformQuery(e){return this.#f.transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}let T="kysely_migration",B="kysely_migration_lock";function L(e){return(0,d.isObject)(e)&&(0,d.isFunction)(e.toOperationNode)}(0,d.freeze)({__noMigrations__:!0}),e.s(["sql",()=>ii],13031),e.s(["isOperationNodeSource",()=>L],44473);var A=e.i(1765);e.s(["ValueNode",()=>R],4196);let R=(0,d.freeze)({is:e=>"ValueNode"===e.kind,create:e=>(0,d.freeze)({kind:"ValueNode",value:e}),createImmediate:e=>(0,d.freeze)({kind:"ValueNode",value:e,immediate:!0})});e.s(["parseAliasedStringReference",()=>t5,"parseColumnName",()=>t4,"parseJSONReference",()=>t6,"parseOrderedColumnName",()=>t2,"parseReferenceExpression",()=>t9,"parseReferenceExpressionOrList",()=>t1,"parseSimpleReferenceExpression",()=>t0,"parseStringReference",()=>t8],58390),e.s(["ColumnNode",()=>D],81196);let D=(0,d.freeze)({is:e=>"ColumnNode"===e.kind,create:e=>(0,d.freeze)({kind:"ColumnNode",column:a.IdentifierNode.create(e)})});e.s(["SelectAllNode",()=>M],44550);let M=(0,d.freeze)({is:e=>"SelectAllNode"===e.kind,create:()=>(0,d.freeze)({kind:"SelectAllNode"})}),E=(0,d.freeze)({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>(0,d.freeze)({kind:"ReferenceNode",table:e,column:M.create()})});function F(e){return(0,d.isObject)(e)&&"expressionType"in e&&L(e)}e.s(["isExpressionOrFactory",()=>tZ,"parseAliasedExpression",()=>tY,"parseExpression",()=>tX],69918);let P=(0,d.freeze)({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>(0,d.freeze)({kind:"SelectModifierNode",rawModifier:e})});e.s(["parseFilterList",()=>Y,"parseFilterObject",()=>X,"parseReferentialBinaryOperation",()=>H,"parseValueBinaryOperation",()=>_,"parseValueBinaryOperationOrExpression",()=>G],54996);let U=(0,d.freeze)({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,i)=>(0,d.freeze)({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:i})}),J=(0,d.freeze)({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>(0,d.freeze)({kind:"PrimitiveValueListNode",values:(0,d.freeze)([...e])})});e.s(["ValueListNode",()=>V],93846);let V=(0,d.freeze)({is:e=>"ValueListNode"===e.kind,create:e=>(0,d.freeze)({kind:"ValueListNode",values:(0,d.freeze)(e)})});function j(e){return tZ(e)?tX(e):R.create(e)}function $(e){return(0,d.isNumber)(e)||(0,d.isBoolean)(e)||(0,d.isNull)(e)}function K(e){if(!$(e))throw Error(`unsafe immediate value ${JSON.stringify(e)}`);return R.createImmediate(e)}function G(e){if(3===e.length)return _(e[0],e[1],e[2]);if(1===e.length)return j(e[0]);throw Error(`invalid arguments: ${JSON.stringify(e)}`)}function _(e,t,i){var r,o;if(("is"===(r=t)||"is not"===r)&&Z(i))return U.create(t9(e),ee(t),R.createImmediate(i));return U.create(t9(e),ee(t),(0,d.isReadonlyArray)(i)?(o=i).some(tZ)?V.create(o.map(e=>j(e))):J.create(o):j(i))}function H(e,t,i){return U.create(t9(e),ee(t),t9(i))}function X(e,t){return Y(Object.entries(e).filter(([,e])=>!(0,d.isUndefined)(e)).map(([e,t])=>_(e,Z(t)?"is":"=",t)),t)}function Y(e,t,i=!0){let r="and"===t?b.AndNode.create:O.OrNode.create;if(0===e.length)return U.create(R.createImmediate(1),o.OperatorNode.create("="),R.createImmediate(+("and"===t)));let s=et(e[0]);for(let t=1;t<e.length;++t)s=r(s,et(e[t]));return e.length>1&&i?n.ParensNode.create(s):s}function Z(e){return(0,d.isNull)(e)||(0,d.isBoolean)(e)}function ee(e){if((0,d.isString)(e)&&o.OPERATORS.includes(e))return o.OperatorNode.create(e);if(L(e))return e.toOperationNode();throw Error(`invalid operator ${JSON.stringify(e)}`)}function et(e){return L(e)?e.toOperationNode():e}var ei=e.i(69565);let er=(0,d.freeze)({is:e=>"PartitionByNode"===e.kind,create:e=>(0,d.freeze)({kind:"PartitionByNode",items:(0,d.freeze)(e)}),cloneWithItems:(e,t)=>(0,d.freeze)({...e,items:(0,d.freeze)([...e.items,...t])})}),eo=(0,d.freeze)({is:e=>"OverNode"===e.kind,create:()=>(0,d.freeze)({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>(0,d.freeze)({...e,orderBy:e.orderBy?ei.OrderByNode.cloneWithItems(e.orderBy,t):ei.OrderByNode.create(t)}),cloneWithPartitionByItems:(e,t)=>(0,d.freeze)({...e,partitionBy:e.partitionBy?er.cloneWithItems(e.partitionBy,t):er.create(t)})});var en=e.i(19254);class es{#m;constructor(e){this.#m=(0,d.freeze)(e)}on(...e){return new es({...this.#m,joinNode:x.cloneWithOn(this.#m.joinNode,G(e))})}onRef(e,t,i){return new es({...this.#m,joinNode:x.cloneWithOn(this.#m.joinNode,H(e,t,i))})}onTrue(){return new es({...this.#m,joinNode:x.cloneWithOn(this.#m.joinNode,A.RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#m.joinNode}}e.s(["DynamicReferenceBuilder",()=>ed,"isDynamicReferenceBuilder",()=>ea],70445);class ed{#y;get dynamicReference(){return this.#y}get refType(){}constructor(e){this.#y=e}toOperationNode(){return t0(this.#y)}}function ea(e){return(0,d.isObject)(e)&&L(e)&&(0,d.isString)(e.dynamicReference)}let eh=(0,d.freeze)({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"OrderByItemNode",orderBy:e,direction:t}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t})}),ep={create:e=>(0,d.freeze)({kind:"CollateNode",collation:a.IdentifierNode.create(e)})};class eu{#m;constructor(e){this.#m=(0,d.freeze)(e)}desc(){return new eu({node:eh.cloneWith(this.#m.node,{direction:A.RawNode.createWithSql("desc")})})}asc(){return new eu({node:eh.cloneWith(this.#m.node,{direction:A.RawNode.createWithSql("asc")})})}nullsLast(){return new eu({node:eh.cloneWith(this.#m.node,{nulls:"last"})})}nullsFirst(){return new eu({node:eh.cloneWith(this.#m.node,{nulls:"first"})})}collate(e){return new eu({node:eh.cloneWith(this.#m.node,{collation:ep.create(e)})})}toOperationNode(){return this.#m.node}}function el(e){return"asc"===e||"desc"===e}function ec(e){if(2===e.length)return[eN(e[0],e[1])];if(1===e.length){let[t]=e;return Array.isArray(t)?(N("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map(e=>eN(e))):[eN(t)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function eN(e,t){let i=function(e){if(tZ(e))return tX(e);if(ea(e))return e.toOperationNode();let[t,i]=e.split(" ");return i?(N("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),ef(t8(t),i)):t8(e)}(e);if(eh.is(i)){if(t)throw Error("Cannot specify direction twice!");return i}return ef(i,t)}function ef(e,t){if("string"==typeof t){if(!el(t))throw Error(`Invalid order by direction: ${t}`);return eh.create(e,A.RawNode.createWithSql(t))}if(F(t))return N("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),eh.create(e,t.toOperationNode());let i=eh.create(e);return t?t(new eu({node:i})).toOperationNode():i}let em=(0,d.freeze)({is:e=>"PartitionByItemNode"===e.kind,create:e=>(0,d.freeze)({kind:"PartitionByItemNode",partitionBy:e})});class ey{#m;constructor(e){this.#m=(0,d.freeze)(e)}orderBy(...e){return new ey({overNode:eo.cloneWithOrderByItems(this.#m.overNode,ec(e))})}clearOrderBy(){return new ey({overNode:s.QueryNode.cloneWithoutOrderBy(this.#m.overNode)})}partitionBy(e){return new ey({overNode:eo.cloneWithPartitionByItems(this.#m.overNode,t1(e).map(em.create))})}$call(e){return e(this)}toOperationNode(){return this.#m.overNode}}e.s(["QueryCreator",()=>tN],78800);let ew=(0,d.freeze)({is:e=>"SelectionNode"===e.kind,create:e=>(0,d.freeze)({kind:"SelectionNode",selection:e}),createSelectAll:()=>(0,d.freeze)({kind:"SelectionNode",selection:M.create()}),createSelectAllFromTable:e=>(0,d.freeze)({kind:"SelectionNode",selection:E.createSelectAll(e)})});e.s(["parseAliasedTable",()=>ex,"parseTable",()=>ez,"parseTableExpression",()=>eW,"parseTableExpressionOrList",()=>eO],92465),e.s(["DynamicTableBuilder",()=>eg,"isAliasedDynamicTableBuilder",()=>eb],26015);class eg{#w;get table(){return this.#w}constructor(e){this.#w=e}as(e){return new ev(this.#w,e)}}class ev{#w;#g;get table(){return this.#w}get alias(){return this.#g}constructor(e,t){this.#w=e,this.#g=t}toOperationNode(){return v.create(ez(this.#w),a.IdentifierNode.create(this.#g))}}function eb(e){return(0,d.isObject)(e)&&L(e)&&(0,d.isString)(e.table)&&(0,d.isString)(e.alias)}function eO(e){return(0,d.isReadonlyArray)(e)?e.map(e=>eW(e)):[eW(e)]}function eW(e){return(0,d.isString)(e)?ex(e):eb(e)?e.toOperationNode():tY(e)}function ex(e){let t=" as ";if(!e.includes(t))return ez(e);{let[i,r]=e.split(t).map(eC);return v.create(ez(i),a.IdentifierNode.create(r))}}function ez(e){if(!e.includes("."))return q.create(e);{let[t,i]=e.split(".").map(eC);return q.createWithSchema(t,i)}}function eC(e){return e.trim()}function eq(e){return(0,d.isFunction)(e)?eq(e(tH())):(0,d.isReadonlyArray)(e)?e.map(e=>ek(e)):[ek(e)]}function ek(e){return(0,d.isString)(e)?ew.create(t5(e)):ea(e)?ew.create(e.toOperationNode()):ew.create(tY(e))}function eI(e){return e?Array.isArray(e)?e.map(eS):[eS(e)]:[ew.createSelectAll()]}function eS(e){if((0,d.isString)(e))return ew.createSelectAllFromTable(ez(e));throw Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}let eQ=(0,d.freeze)({is:e=>"ValuesNode"===e.kind,create:e=>(0,d.freeze)({kind:"ValuesNode",values:(0,d.freeze)(e)})}),eT=(0,d.freeze)({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>(0,d.freeze)({kind:"DefaultInsertValueNode"})});function eB(e){let t=(0,d.isFunction)(e)?e(tH()):e;var i=(0,d.isReadonlyArray)(t)?t:(0,d.freeze)([t]);let r=function(e){let t=new Map;for(let i of e)for(let e of Object.keys(i))t.has(e)||void 0===i[e]||t.set(e,t.size);return t}(i);return[(0,d.freeze)([...r.keys()].map(D.create)),eQ.create(i.map(e=>(function(e,t){let i=Object.keys(e),r=Array.from({length:t.size}),o=!1,n=i.length;for(let s of i){let i=t.get(s);if((0,d.isUndefined)(i)){n--;continue}let a=e[s];((0,d.isUndefined)(a)||tZ(a))&&(o=!0),r[i]=a}if(n<t.size||o){let e=eT.create();return V.create(r.map(t=>(0,d.isUndefined)(t)?e:j(t)))}return J.create(r)})(e,r)))]}let eL=(0,d.freeze)({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"ColumnUpdateNode",column:e,value:t})});function eA(e){return Object.entries((0,d.isFunction)(e)?e(tH()):e).filter(([e,t])=>void 0!==t).map(([e,t])=>eL.create(D.create(e),j(t)))}let eR=(0,d.freeze)({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>(0,d.freeze)({kind:"OnDuplicateKeyNode",updates:e})});class eD{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class eM extends Error{node;constructor(e){super("no result"),this.node=e}}function eE(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}var eF=e.i(10636);let eP=(0,d.freeze)({is:e=>"OnConflictNode"===e.kind,create:()=>(0,d.freeze)({kind:"OnConflictNode"}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t}),cloneWithIndexWhere:(e,t)=>(0,d.freeze)({...e,indexWhere:e.indexWhere?eF.WhereNode.cloneWithOperation(e.indexWhere,"And",t):eF.WhereNode.create(t)}),cloneWithIndexOrWhere:(e,t)=>(0,d.freeze)({...e,indexWhere:e.indexWhere?eF.WhereNode.cloneWithOperation(e.indexWhere,"Or",t):eF.WhereNode.create(t)}),cloneWithUpdateWhere:(e,t)=>(0,d.freeze)({...e,updateWhere:e.updateWhere?eF.WhereNode.cloneWithOperation(e.updateWhere,"And",t):eF.WhereNode.create(t)}),cloneWithUpdateOrWhere:(e,t)=>(0,d.freeze)({...e,updateWhere:e.updateWhere?eF.WhereNode.cloneWithOperation(e.updateWhere,"Or",t):eF.WhereNode.create(t)}),cloneWithoutIndexWhere:e=>(0,d.freeze)({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>(0,d.freeze)({...e,updateWhere:void 0})});class eU{#m;constructor(e){this.#m=(0,d.freeze)(e)}column(e){let t=D.create(e);return new eU({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{columns:this.#m.onConflictNode.columns?(0,d.freeze)([...this.#m.onConflictNode.columns,t]):(0,d.freeze)([t])})})}columns(e){let t=e.map(D.create);return new eU({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{columns:this.#m.onConflictNode.columns?(0,d.freeze)([...this.#m.onConflictNode.columns,...t]):(0,d.freeze)(t)})})}constraint(e){return new eU({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{constraint:a.IdentifierNode.create(e)})})}expression(e){return new eU({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new eU({...this.#m,onConflictNode:eP.cloneWithIndexWhere(this.#m.onConflictNode,G(e))})}whereRef(e,t,i){return new eU({...this.#m,onConflictNode:eP.cloneWithIndexWhere(this.#m.onConflictNode,H(e,t,i))})}clearWhere(){return new eU({...this.#m,onConflictNode:eP.cloneWithoutIndexWhere(this.#m.onConflictNode)})}doNothing(){return new eJ({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new eV({...this.#m,onConflictNode:eP.cloneWith(this.#m.onConflictNode,{updates:eA(e)})})}$call(e){return e(this)}}class eJ{#m;constructor(e){this.#m=(0,d.freeze)(e)}toOperationNode(){return this.#m.onConflictNode}}class eV{#m;constructor(e){this.#m=(0,d.freeze)(e)}where(...e){return new eV({...this.#m,onConflictNode:eP.cloneWithUpdateWhere(this.#m.onConflictNode,G(e))})}whereRef(e,t,i){return new eV({...this.#m,onConflictNode:eP.cloneWithUpdateWhere(this.#m.onConflictNode,H(e,t,i))})}clearWhere(){return new eV({...this.#m,onConflictNode:eP.cloneWithoutUpdateWhere(this.#m.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#m.onConflictNode}}let ej=(0,d.freeze)({is:e=>"TopNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"TopNode",expression:e,modifiers:t})});function e$(e,t){var i;if(!(0,d.isNumber)(e)&&!(0,d.isBigInt)(e))throw Error(`Invalid top expression: ${e}`);if(!(0,d.isUndefined)(t)&&"percent"!==(i=t)&&"with ties"!==i&&"percent with ties"!==i)throw Error(`Invalid top modifiers: ${t}`);return ej.create(e,t)}let eK=(0,d.freeze)({is:e=>"OrActionNode"===e.kind,create:e=>(0,d.freeze)({kind:"OrActionNode",action:e})});class eG{#m;constructor(e){this.#m=(0,d.freeze)(e)}values(e){let[t,r]=eB(e);return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{columns:t,values:r})})}columns(e){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{columns:(0,d.freeze)(e.map(D.create))})})}expression(e){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{values:tX(e)})})}defaultValues(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{defaultValues:!0})})}modifyEnd(e){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,e.toOperationNode())})}ignore(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("ignore")})})}orIgnore(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("ignore")})})}orAbort(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("abort")})})}orFail(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("fail")})})}orReplace(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("replace")})})}orRollback(){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{orAction:eK.create("rollback")})})}top(e,t){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}onConflict(e){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{onConflict:e(new eU({onConflictNode:eP.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new eG({...this.#m,queryNode:i.InsertQueryNode.cloneWith(this.#m.queryNode,{onDuplicateKey:eR.create(eA(e))})})}returning(e){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eq(e))})}returningAll(){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eI())})}output(e){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eq(e))})}outputAll(e){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eI(e))})}clearReturning(){return new eG({...this.#m,queryNode:s.QueryNode.cloneWithoutReturning(this.#m.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new eG({...this.#m})}$castTo(){return new eG(this.#m)}$narrowType(){return new eG(this.#m)}$assertType(){return new eG(this.#m)}withPlugin(e){return new eG({...this.#m,executor:this.#m.executor.withPlugin(e)})}toOperationNode(){return this.#m.executor.transformQuery(this.#m.queryNode,this.#m.queryId)}compile(){return this.#m.executor.compileQuery(this.toOperationNode(),this.#m.queryId)}async execute(){let e=this.compile(),t=await this.#m.executor.executeQuery(e),{adapter:i}=this.#m.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new eD(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=eM){let t=await this.executeTakeFirst();if(void 0===t)throw eE(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#m.executor.stream(t,e))yield*i.rows}async explain(e,t){let i=new eG({...this.#m,queryNode:s.QueryNode.cloneWithExplain(this.#m.queryNode,e,t)});return await i.execute()}}class e_{numDeletedRows;constructor(e){this.numDeletedRows=e}}var eH=e.i(91889);let eX=(0,d.freeze)({is:e=>"LimitNode"===e.kind,create:e=>(0,d.freeze)({kind:"LimitNode",limit:e})});class eY{#m;constructor(e){this.#m=(0,d.freeze)(e)}where(...e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,G(e))})}whereRef(e,t,i){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,H(e,t,i))})}clearWhere(){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithoutWhere(this.#m.queryNode)})}top(e,t){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}using(e){return new eY({...this.#m,queryNode:eH.DeleteQueryNode.cloneWithUsing(this.#m.queryNode,eO(e))})}innerJoin(...e){return this.#v("InnerJoin",e)}leftJoin(...e){return this.#v("LeftJoin",e)}rightJoin(...e){return this.#v("RightJoin",e)}fullJoin(...e){return this.#v("FullJoin",e)}#v(e,t){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithJoin(this.#m.queryNode,tf(e,t))})}returning(e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eq(e))})}returningAll(e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eI(e))})}output(e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eq(e))})}outputAll(e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eI(e))})}clearReturning(){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithoutReturning(this.#m.queryNode)})}clearLimit(){return new eY({...this.#m,queryNode:eH.DeleteQueryNode.cloneWithoutLimit(this.#m.queryNode)})}orderBy(...e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithOrderByItems(this.#m.queryNode,ec(e))})}clearOrderBy(){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithoutOrderBy(this.#m.queryNode)})}limit(e){return new eY({...this.#m,queryNode:eH.DeleteQueryNode.cloneWithLimit(this.#m.queryNode,eX.create(j(e)))})}modifyEnd(e){return new eY({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new eY({...this.#m})}$castTo(){return new eY(this.#m)}$narrowType(){return new eY(this.#m)}$assertType(){return new eY(this.#m)}withPlugin(e){return new eY({...this.#m,executor:this.#m.executor.withPlugin(e)})}toOperationNode(){return this.#m.executor.transformQuery(this.#m.queryNode,this.#m.queryId)}compile(){return this.#m.executor.compileQuery(this.toOperationNode(),this.#m.queryId)}async execute(){let e=this.compile(),t=await this.#m.executor.executeQuery(e),{adapter:i}=this.#m.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new e_(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=eM){let t=await this.executeTakeFirst();if(void 0===t)throw eE(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#m.executor.stream(t,e))yield*i.rows}async explain(e,t){let i=new eY({...this.#m,queryNode:s.QueryNode.cloneWithExplain(this.#m.queryNode,e,t)});return await i.execute()}}var eZ=e.i(88758);class e0{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class e1{#m;constructor(e){this.#m=(0,d.freeze)(e)}where(...e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,G(e))})}whereRef(e,t,i){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,H(e,t,i))})}clearWhere(){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithoutWhere(this.#m.queryNode)})}top(e,t){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}from(e){return new e1({...this.#m,queryNode:eZ.UpdateQueryNode.cloneWithFromItems(this.#m.queryNode,eO(e))})}innerJoin(...e){return this.#v("InnerJoin",e)}leftJoin(...e){return this.#v("LeftJoin",e)}rightJoin(...e){return this.#v("RightJoin",e)}fullJoin(...e){return this.#v("FullJoin",e)}#v(e,t){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithJoin(this.#m.queryNode,tf(e,t))})}orderBy(...e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithOrderByItems(this.#m.queryNode,ec(e))})}clearOrderBy(){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithoutOrderBy(this.#m.queryNode)})}limit(e){return new e1({...this.#m,queryNode:eZ.UpdateQueryNode.cloneWithLimit(this.#m.queryNode,eX.create(j(e)))})}set(...e){return new e1({...this.#m,queryNode:eZ.UpdateQueryNode.cloneWithUpdates(this.#m.queryNode,function(...e){return 2===e.length?[eL.create(t9(e[0]),j(e[1]))]:eA(e[0])}(...e))})}returning(e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eq(e))})}returningAll(e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eI(e))})}output(e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eq(e))})}outputAll(e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eI(e))})}modifyEnd(e){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,e.toOperationNode())})}clearReturning(){return new e1({...this.#m,queryNode:s.QueryNode.cloneWithoutReturning(this.#m.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new e1({...this.#m})}$castTo(){return new e1(this.#m)}$narrowType(){return new e1(this.#m)}$assertType(){return new e1(this.#m)}withPlugin(e){return new e1({...this.#m,executor:this.#m.executor.withPlugin(e)})}toOperationNode(){return this.#m.executor.transformQuery(this.#m.queryNode,this.#m.queryId)}compile(){return this.#m.executor.compileQuery(this.toOperationNode(),this.#m.queryId)}async execute(){let e=this.compile(),t=await this.#m.executor.executeQuery(e),{adapter:i}=this.#m.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new e0(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=eM){let t=await this.executeTakeFirst();if(void 0===t)throw eE(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#m.executor.stream(t,e))yield*i.rows}async explain(e,t){let i=new e1({...this.#m,queryNode:s.QueryNode.cloneWithExplain(this.#m.queryNode,e,t)});return await i.execute()}}let e9=(0,d.freeze)({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"CommonTableExpressionNameNode",table:q.create(e),columns:t?(0,d.freeze)(t.map(D.create)):void 0})}),e6=(0,d.freeze)({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t})});class e8{#m;constructor(e){this.#m=(0,d.freeze)(e)}materialized(){return new e8({...this.#m,node:e6.cloneWith(this.#m.node,{materialized:!0})})}notMaterialized(){return new e8({...this.#m,node:e6.cloneWith(this.#m.node,{materialized:!1})})}toOperationNode(){return this.#m.node}}function e5(e,t){var i;let r=t(new tN({executor:ta})).toOperationNode();return(0,d.isFunction)(e)?e((i=r,e=>new e8({node:e6.create(e4(e),i)}))).toOperationNode():e6.create(e4(e),r)}function e4(e){if(!e.includes("("))return e9.create(e);{let t=e.split(/[\(\)]/),i=t[0],r=t[1].split(",").map(e=>e.trim());return e9.create(i,r)}}let e2=(0,d.freeze)({is:e=>"WithNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"WithNode",expressions:(0,d.freeze)([e]),...t}),cloneWithExpression:(e,t)=>(0,d.freeze)({...e,expressions:(0,d.freeze)([...e.expressions,t])})});var e7=e.i(26951);let e3=(0,d.freeze)({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>(0,d.freeze)({kind:"MatchedNode",not:e,bySource:t})});var te=e.i(2423);function tt(e,t,i){return te.WhenNode.create(Y([e3.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&i?H(t[0],t[1],t[2]):G(t)]:[]],"and",!1))}function ti(e){return(0,d.isString)(e)?A.RawNode.create([e],[]):L(e)?e.toOperationNode():e}e.s(["QueryExecutorBase",()=>ts],52564),e.s(["provideControlledConnection",()=>to],46599),e.s(["Deferred",()=>tr],86474);class tr{#b;#O;#W;constructor(){this.#b=new Promise((e,t)=>{this.#W=t,this.#O=e})}get promise(){return this.#b}resolve=e=>{this.#O&&this.#O(e)};reject=e=>{this.#W&&this.#W(e)}}async function to(e){let t=new tr,i=new tr;return e.provideConnection(async e=>(t.resolve(e),await i.promise)).catch(e=>t.reject(e)),(0,d.freeze)({connection:await t.promise,release:i.resolve})}let tn=(0,d.freeze)([]);class ts{#x;constructor(e=tn){this.#x=e}get plugins(){return this.#x}transformQuery(e,t){for(let i of this.#x){let r=i.transformQuery({node:e,queryId:t});if(r.kind===e.kind)e=r;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${e.kind} but it returned a ${r.kind}`)}return e}async executeQuery(e){return await this.provideConnection(async t=>{let i=await t.executeQuery(e);return"numUpdatedOrDeletedRows"in i&&N("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#z(i,e.queryId)})}async *stream(e,t){let{connection:i,release:r}=await to(this);try{for await(let r of i.streamQuery(e,t))yield await this.#z(r,e.queryId)}finally{r()}}async #z(e,t){for(let i of this.#x)e=await i.transformResult({result:e,queryId:t});return e}}class td extends ts{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(e){return new td([...this.plugins,e])}withPlugins(e){return new td([...this.plugins,...e])}withPluginAtFront(e){return new td([e,...this.plugins])}withoutPlugins(){return new td([])}}let ta=new td;class th{numChangedRows;constructor(e){this.numChangedRows=e}}class tp{#m;constructor(e){this.#m=(0,d.freeze)(e)}modifyEnd(e){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,e.toOperationNode())})}top(e,t){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}using(...e){return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithUsing(this.#m.queryNode,tf("Using",e))})}returning(e){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eq(e))})}returningAll(e){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eI(e))})}output(e){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eq(e))})}outputAll(e){return new tp({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eI(e))})}}class tu{#m;constructor(e){this.#m=(0,d.freeze)(e)}modifyEnd(e){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,e.toOperationNode())})}top(e,t){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}whenMatched(){return this.#C([])}whenMatchedAnd(...e){return this.#C(e)}whenMatchedAndRef(e,t,i){return this.#C([e,t,i],!0)}#C(e,t){return new tl({...this.#m,queryNode:l.MergeQueryNode.cloneWithWhen(this.#m.queryNode,tt({isMatched:!0},e,t))})}whenNotMatched(){return this.#q([])}whenNotMatchedAnd(...e){return this.#q(e)}whenNotMatchedAndRef(e,t,i){return this.#q([e,t,i],!0)}whenNotMatchedBySource(){return this.#q([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#q(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,i){return this.#q([e,t,i],!0,!0)}returning(e){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eq(e))})}returningAll(e){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithReturning(this.#m.queryNode,eI(e))})}output(e){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eq(e))})}outputAll(e){return new tu({...this.#m,queryNode:s.QueryNode.cloneWithOutput(this.#m.queryNode,eI(e))})}#q(e,t=!1,i=!1){let r={...this.#m,queryNode:l.MergeQueryNode.cloneWithWhen(this.#m.queryNode,tt({isMatched:!1,bySource:i},e,t))};return new(i?tl:tc)(r)}$call(e){return e(this)}$if(e,t){return e?t(this):new tu({...this.#m})}toOperationNode(){return this.#m.executor.transformQuery(this.#m.queryNode,this.#m.queryId)}compile(){return this.#m.executor.compileQuery(this.toOperationNode(),this.#m.queryId)}async execute(){let e=this.compile(),t=await this.#m.executor.executeQuery(e),{adapter:i}=this.#m.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new th(t.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=eM){let t=await this.executeTakeFirst();if(void 0===t)throw eE(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}}class tl{#m;constructor(e){this.#m=(0,d.freeze)(e)}thenDelete(){return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithThen(this.#m.queryNode,ti("delete"))})}thenDoNothing(){return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithThen(this.#m.queryNode,ti("do nothing"))})}thenUpdate(e){return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithThen(this.#m.queryNode,ti(e(new e1({queryId:this.#m.queryId,executor:ta,queryNode:eZ.UpdateQueryNode.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}class tc{#m;constructor(e){this.#m=(0,d.freeze)(e)}thenDoNothing(){return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithThen(this.#m.queryNode,ti("do nothing"))})}thenInsertValues(e){let[t,r]=eB(e);return new tu({...this.#m,queryNode:l.MergeQueryNode.cloneWithThen(this.#m.queryNode,ti(i.InsertQueryNode.cloneWith(i.InsertQueryNode.createWithoutInto(),{columns:t,values:r})))})}}class tN{#m;constructor(e){this.#m=(0,d.freeze)(e)}selectFrom(e){return new tx({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:en.SelectQueryNode.createFrom(eO(e),this.#m.withNode)})}selectNoFrom(e){return new tx({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:en.SelectQueryNode.cloneWithSelections(en.SelectQueryNode.create(this.#m.withNode),eq(e))})}insertInto(e){return new eG({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:i.InsertQueryNode.create(ez(e),this.#m.withNode)})}replaceInto(e){return new eG({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:i.InsertQueryNode.create(ez(e),this.#m.withNode,!0)})}deleteFrom(e){return new eY({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:eH.DeleteQueryNode.create(eO(e),this.#m.withNode)})}updateTable(e){return new e1({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:eZ.UpdateQueryNode.create(eO(e),this.#m.withNode)})}mergeInto(e){return new tp({queryId:(0,e7.createQueryId)(),executor:this.#m.executor,queryNode:l.MergeQueryNode.create(ex(e),this.#m.withNode)})}with(e,t){let i=e5(e,t);return new tN({...this.#m,withNode:this.#m.withNode?e2.cloneWithExpression(this.#m.withNode,i):e2.create(i)})}withRecursive(e,t){let i=e5(e,t);return new tN({...this.#m,withNode:this.#m.withNode?e2.cloneWithExpression(this.#m.withNode,i):e2.create(i,{recursive:!0})})}withPlugin(e){return new tN({...this.#m,executor:this.#m.executor.withPlugin(e)})}withoutPlugins(){return new tN({...this.#m,executor:this.#m.executor.withoutPlugins()})}withSchema(e){return new tN({...this.#m,executor:this.#m.executor.withPluginAtFront(new Q(e))})}}function tf(e,t){var i,r,o,n,s,d;if(3===t.length){return i=e,r=t[0],o=t[1],n=t[2],x.createWithOn(i,eW(r),H(o,"=",n))}if(2===t.length)return function(e,t,i){return i(new es({joinNode:x.create(e,eW(t))})).toOperationNode()}(e,t[0],t[1]);if(1===t.length){return s=e,d=t[0],x.create(s,eW(d))}throw Error("not implemented")}let tm=(0,d.freeze)({is:e=>"OffsetNode"===e.kind,create:e=>(0,d.freeze)({kind:"OffsetNode",offset:e})}),ty=(0,d.freeze)({is:e=>"GroupByItemNode"===e.kind,create:e=>(0,d.freeze)({kind:"GroupByItemNode",groupBy:e})});function tw(e,t,i){return(0,d.isFunction)(t)&&(t=t(tH())),(0,d.isReadonlyArray)(t)||(t=[t]),t.map(t=>u.create(e,tX(t),i))}class tg{#k;constructor(e){this.#k=e}get expressionType(){}as(e){return new tv(this,e)}or(...e){return new tb(O.OrNode.create(this.#k,G(e)))}and(...e){return new tO(b.AndNode.create(this.#k,G(e)))}$castTo(){return new tg(this.#k)}$notNull(){return new tg(this.#k)}toOperationNode(){return this.#k}}class tv{#I;#g;constructor(e,t){this.#I=e,this.#g=t}get expression(){return this.#I}get alias(){return this.#g}toOperationNode(){return v.create(this.#I.toOperationNode(),L(this.#g)?this.#g.toOperationNode():a.IdentifierNode.create(this.#g))}}class tb{#k;constructor(e){this.#k=e}get expressionType(){}as(e){return new tv(this,e)}or(...e){return new tb(O.OrNode.create(this.#k,G(e)))}$castTo(){return new tb(this.#k)}toOperationNode(){return n.ParensNode.create(this.#k)}}class tO{#k;constructor(e){this.#k=e}get expressionType(){}as(e){return new tv(this,e)}and(...e){return new tO(b.AndNode.create(this.#k,G(e)))}$castTo(){return new tO(this.#k)}toOperationNode(){return n.ParensNode.create(this.#k)}}let tW={create:(e,t)=>({kind:"FetchNode",rowCount:R.create(e),modifier:t})};class tx{#m;constructor(e){this.#m=(0,d.freeze)(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,G(e))})}whereRef(e,t,i){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithWhere(this.#m.queryNode,H(e,t,i))})}having(...e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithHaving(this.#m.queryNode,G(e))})}havingRef(e,t,i){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithHaving(this.#m.queryNode,H(e,t,i))})}select(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSelections(this.#m.queryNode,eq(e))})}distinctOn(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithDistinctOn(this.#m.queryNode,t1(e))})}modifyFront(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithFrontModifier(this.#m.queryNode,P.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.createWithExpression(e.toOperationNode()))})}distinct(){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithFrontModifier(this.#m.queryNode,P.create("Distinct"))})}forUpdate(e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("ForUpdate",e?(0,d.asArray)(e).map(ez):void 0))})}forShare(e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("ForShare",e?(0,d.asArray)(e).map(ez):void 0))})}forKeyShare(e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("ForKeyShare",e?(0,d.asArray)(e).map(ez):void 0))})}forNoKeyUpdate(e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("ForNoKeyUpdate",e?(0,d.asArray)(e).map(ez):void 0))})}skipLocked(){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("SkipLocked"))})}noWait(){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithEndModifier(this.#m.queryNode,P.create("NoWait"))})}selectAll(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSelections(this.#m.queryNode,eI(e))})}innerJoin(...e){return this.#v("InnerJoin",e)}leftJoin(...e){return this.#v("LeftJoin",e)}rightJoin(...e){return this.#v("RightJoin",e)}fullJoin(...e){return this.#v("FullJoin",e)}crossJoin(...e){return this.#v("CrossJoin",e)}innerJoinLateral(...e){return this.#v("LateralInnerJoin",e)}leftJoinLateral(...e){return this.#v("LateralLeftJoin",e)}crossJoinLateral(...e){return this.#v("LateralCrossJoin",e)}crossApply(...e){return this.#v("CrossApply",e)}outerApply(...e){return this.#v("OuterApply",e)}#v(e,t){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithJoin(this.#m.queryNode,tf(e,t))})}orderBy(...e){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithOrderByItems(this.#m.queryNode,ec(e))})}groupBy(e){var t;return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithGroupByItems(this.#m.queryNode,(t=e,t1(t=(0,d.isFunction)(t)?t(tH()):t).map(ty.create)))})}limit(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithLimit(this.#m.queryNode,eX.create(j(e)))})}offset(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithOffset(this.#m.queryNode,tm.create(j(e)))})}fetch(e,t="only"){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithFetch(this.#m.queryNode,function(e,t){var i;if(!(0,d.isNumber)(e)&&!(0,d.isBigInt)(e))throw Error(`Invalid fetch row count: ${e}`);if("only"!==(i=t)&&"with ties"!==i)throw Error(`Invalid fetch modifier: ${t}`);return tW.create(e,t)}(e,t))})}top(e,t){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithTop(this.#m.queryNode,e$(e,t))})}union(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("union",e,!1))})}unionAll(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("union",e,!0))})}intersect(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("intersect",e,!1))})}intersectAll(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("intersect",e,!0))})}except(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("except",e,!1))})}exceptAll(e){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithSetOperations(this.#m.queryNode,tw("except",e,!0))})}as(e){return new tz(this,e)}clearSelect(){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithoutSelections(this.#m.queryNode)})}clearWhere(){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithoutWhere(this.#m.queryNode)})}clearLimit(){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithoutLimit(this.#m.queryNode)})}clearOffset(){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithoutOffset(this.#m.queryNode)})}clearOrderBy(){return new tx({...this.#m,queryNode:s.QueryNode.cloneWithoutOrderBy(this.#m.queryNode)})}clearGroupBy(){return new tx({...this.#m,queryNode:en.SelectQueryNode.cloneWithoutGroupBy(this.#m.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new tx({...this.#m})}$castTo(){return new tx(this.#m)}$narrowType(){return new tx(this.#m)}$assertType(){return new tx(this.#m)}$asTuple(){return new tg(this.toOperationNode())}$asScalar(){return new tg(this.toOperationNode())}withPlugin(e){return new tx({...this.#m,executor:this.#m.executor.withPlugin(e)})}toOperationNode(){return this.#m.executor.transformQuery(this.#m.queryNode,this.#m.queryId)}compile(){return this.#m.executor.compileQuery(this.toOperationNode(),this.#m.queryId)}async execute(){let e=this.compile();return(await this.#m.executor.executeQuery(e)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=eM){let t=await this.executeTakeFirst();if(void 0===t)throw eE(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#m.executor.stream(t,e))yield*i.rows}async explain(e,t){let i=new tx({...this.#m,queryNode:s.QueryNode.cloneWithExplain(this.#m.queryNode,e,t)});return await i.execute()}}class tz{#S;#g;constructor(e,t){this.#S=e,this.#g=t}get expression(){return this.#S}get alias(){return this.#g}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return v.create(this.#S.toOperationNode(),a.IdentifierNode.create(this.#g))}}e.s(["createFunctionModule",()=>tS],25176);let tC=(0,d.freeze)({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>(0,d.freeze)({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>(0,d.freeze)({...e,distinct:!0}),cloneWithOrderBy(e,t,i=!1){let r=i?"withinGroup":"orderBy";return(0,d.freeze)({...e,[r]:e[r]?ei.OrderByNode.cloneWithItems(e[r],t):ei.OrderByNode.create(t)})},cloneWithFilter:(e,t)=>(0,d.freeze)({...e,filter:e.filter?eF.WhereNode.cloneWithOperation(e.filter,"And",t):eF.WhereNode.create(t)}),cloneWithOrFilter:(e,t)=>(0,d.freeze)({...e,filter:e.filter?eF.WhereNode.cloneWithOperation(e.filter,"Or",t):eF.WhereNode.create(t)}),cloneWithOver:(e,t)=>(0,d.freeze)({...e,over:t})}),tq=(0,d.freeze)({is:e=>"FunctionNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"FunctionNode",func:e,arguments:t})});class tk{#m;constructor(e){this.#m=(0,d.freeze)(e)}get expressionType(){}as(e){return new tI(this,e)}distinct(){return new tk({...this.#m,aggregateFunctionNode:tC.cloneWithDistinct(this.#m.aggregateFunctionNode)})}orderBy(...e){return new tk({...this.#m,aggregateFunctionNode:s.QueryNode.cloneWithOrderByItems(this.#m.aggregateFunctionNode,ec(e))})}clearOrderBy(){return new tk({...this.#m,aggregateFunctionNode:s.QueryNode.cloneWithoutOrderBy(this.#m.aggregateFunctionNode)})}withinGroupOrderBy(...e){return new tk({...this.#m,aggregateFunctionNode:tC.cloneWithOrderBy(this.#m.aggregateFunctionNode,ec(e),!0)})}filterWhere(...e){return new tk({...this.#m,aggregateFunctionNode:tC.cloneWithFilter(this.#m.aggregateFunctionNode,G(e))})}filterWhereRef(e,t,i){return new tk({...this.#m,aggregateFunctionNode:tC.cloneWithFilter(this.#m.aggregateFunctionNode,H(e,t,i))})}over(e){let t=new ey({overNode:eo.create()});return new tk({...this.#m,aggregateFunctionNode:tC.cloneWithOver(this.#m.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new tk(this.#m)}$notNull(){return new tk(this.#m)}toOperationNode(){return this.#m.aggregateFunctionNode}}class tI{#Q;#g;constructor(e,t){this.#Q=e,this.#g=t}get expression(){return this.#Q}get alias(){return this.#g}toOperationNode(){return v.create(this.#Q.toOperationNode(),a.IdentifierNode.create(this.#g))}}function tS(){let e=(e,t)=>new tg(tq.create(e,t1(t??[]))),t=(e,t)=>new tk({aggregateFunctionNode:tC.create(e,t?t1(t):void 0)});return Object.assign(e,{agg:t,avg:e=>t("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>t("count",[e]),countAll:e=>new tk({aggregateFunctionNode:tC.create("count",eI(e))}),max:e=>t("max",[e]),min:e=>t("min",[e]),sum:e=>t("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new tk({aggregateFunctionNode:tC.create("json_agg",[(0,d.isString)(e)?ez(e):e.toOperationNode()])}),toJson:e=>new tg(tq.create("to_json",[(0,d.isString)(e)?ez(e):e.toOperationNode()]))})}let tQ=(0,d.freeze)({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"UnaryOperationNode",operator:e,operand:t})});e.s(["CaseBuilder",()=>tB],91658),e.s(["CaseNode",()=>tT],2757);let tT=(0,d.freeze)({is:e=>"CaseNode"===e.kind,create:e=>(0,d.freeze)({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>(0,d.freeze)({...e,when:(0,d.freeze)(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>(0,d.freeze)({...e,when:e.when?(0,d.freeze)([...e.when.slice(0,-1),te.WhenNode.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t})});class tB{#m;constructor(e){this.#m=(0,d.freeze)(e)}when(...e){return new tL({...this.#m,node:tT.cloneWithWhen(this.#m.node,te.WhenNode.create(G(e)))})}}class tL{#m;constructor(e){this.#m=(0,d.freeze)(e)}then(e){return new tA({...this.#m,node:tT.cloneWithThen(this.#m.node,$(e)?K(e):j(e))})}}class tA{#m;constructor(e){this.#m=(0,d.freeze)(e)}when(...e){return new tL({...this.#m,node:tT.cloneWithWhen(this.#m.node,te.WhenNode.create(G(e)))})}else(e){return new tR({...this.#m,node:tT.cloneWith(this.#m.node,{else:$(e)?K(e):j(e)})})}end(){return new tg(tT.cloneWith(this.#m.node,{isStatement:!1}))}endCase(){return new tg(tT.cloneWith(this.#m.node,{isStatement:!0}))}}class tR{#m;constructor(e){this.#m=(0,d.freeze)(e)}end(){return new tg(tT.cloneWith(this.#m.node,{isStatement:!1}))}endCase(){return new tg(tT.cloneWith(this.#m.node,{isStatement:!0}))}}let tD=(0,d.freeze)({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>(0,d.freeze)({kind:"JSONOperatorChainNode",operator:e,values:(0,d.freeze)([])}),cloneWithValue:(e,t)=>(0,d.freeze)({...e,values:(0,d.freeze)([...e.values,t])})}),tM=(0,d.freeze)({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"JSONPathLegNode",type:e,value:t})}),tE=(0,d.freeze)({is:e=>"JSONPathNode"===e.kind,create:e=>(0,d.freeze)({kind:"JSONPathNode",inOperator:e,pathLegs:(0,d.freeze)([])}),cloneWithLeg:(e,t)=>(0,d.freeze)({...e,pathLegs:(0,d.freeze)([...e.pathLegs,t])})}),tF=(0,d.freeze)({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>(0,d.freeze)({...e,traversal:t})});class tP{#k;constructor(e){this.#k=e}at(e){return this.#T("ArrayLocation",e)}key(e){return this.#T("Member",e)}#T(e,t){return new tU(tF.is(this.#k)?tF.cloneWithTraversal(this.#k,tE.is(this.#k.traversal)?tE.cloneWithLeg(this.#k.traversal,tM.create(e,t)):tD.cloneWithValue(this.#k.traversal,R.createImmediate(t))):tE.cloneWithLeg(this.#k,tM.create(e,t)))}}class tU extends tP{#k;constructor(e){super(e),this.#k=e}get expressionType(){}as(e){return new tJ(this,e)}$castTo(){return new tU(this.#k)}$notNull(){return new tU(this.#k)}toOperationNode(){return this.#k}}class tJ{#B;#g;constructor(e,t){this.#B=e,this.#g=t}get expression(){return this.#B}get alias(){return this.#g}toOperationNode(){return v.create(this.#B.toOperationNode(),L(this.#g)?this.#g.toOperationNode():a.IdentifierNode.create(this.#g))}}let tV=(0,d.freeze)({is:e=>"TupleNode"===e.kind,create:e=>(0,d.freeze)({kind:"TupleNode",values:(0,d.freeze)(e)})});e.s(["parseDataTypeExpression",()=>tG],75670);let tj=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],t$=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],tK=(0,d.freeze)({is:e=>"DataTypeNode"===e.kind,create:e=>(0,d.freeze)({kind:"DataTypeNode",dataType:e})});function tG(e){if(L(e))return e.toOperationNode();if(tj.includes(e)||t$.some(t=>t.test(e)))return tK.create(e);throw Error(`invalid column data type ${JSON.stringify(e)}`)}let t_=(0,d.freeze)({is:e=>"CastNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"CastNode",expression:e,dataType:t})});function tH(e=ta){function t(e,t){return new tg(tQ.create(o.OperatorNode.create(e),t9(t)))}let i=Object.assign(function(e,t,i){return new tg(_(e,t,i))},{fn:void 0,eb:void 0,selectFrom:t=>new tx({queryId:(0,e7.createQueryId)(),executor:e,queryNode:en.SelectQueryNode.createFrom(eO(t))}),case:e=>new tB({node:tT.create((0,d.isUndefined)(e)?void 0:t9(e))}),ref:(e,t)=>(0,d.isUndefined)(t)?new tg(t8(e)):new tP(t6(e,t)),jsonPath:()=>new tP(tE.create()),table:e=>new tg(ez(e)),val:e=>new tg(j(e)),refTuple:(...e)=>new tg(tV.create(e.map(t9))),tuple:(...e)=>new tg(tV.create(e.map(j))),lit:e=>new tg(K(e)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),between:(e,t,i)=>new tg(U.create(t9(e),o.OperatorNode.create("between"),b.AndNode.create(j(t),j(i)))),betweenSymmetric:(e,t,i)=>new tg(U.create(t9(e),o.OperatorNode.create("between symmetric"),b.AndNode.create(j(t),j(i)))),and:e=>new tg((0,d.isReadonlyArray)(e)?Y(e,"and"):X(e,"and")),or:e=>new tg((0,d.isReadonlyArray)(e)?Y(e,"or"):X(e,"or")),parens(...e){let t=G(e);return new tg(n.ParensNode.is(t)?t:n.ParensNode.create(t))},cast:(e,t)=>new tg(t_.create(t9(e),tG(t))),withSchema:t=>tH(e.withPluginAtFront(new Q(t)))});return i.fn=tS(),i.eb=i,i}function tX(e){if(L(e))return e.toOperationNode();if((0,d.isFunction)(e))return e(tH()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(e)}`)}function tY(e){if(L(e))return e.toOperationNode();if((0,d.isFunction)(e))return e(tH()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function tZ(e){return F(e)||(0,d.isObject)(e)&&"expression"in e&&(0,d.isString)(e.alias)&&L(e)||(0,d.isFunction)(e)}function t0(e){return(0,d.isString)(e)?t8(e):e.toOperationNode()}function t1(e){return(0,d.isReadonlyArray)(e)?e.map(e=>t9(e)):[t9(e)]}function t9(e){return tZ(e)?tX(e):t0(e)}function t6(e,t){let i=t8(e);if((0,o.isJSONOperator)(t))return tF.create(i,tD.create(o.OperatorNode.create(t)));let r=t.slice(0,-1);if((0,o.isJSONOperator)(r))return tF.create(i,tE.create(o.OperatorNode.create(r)));throw Error(`Invalid JSON operator: ${t}`)}function t8(e){if(!e.includes("."))return E.create(D.create(e));let t=e.split(".").map(t7);if(3===t.length){var i=t;let[e,r,o]=i;return E.create(D.create(o),q.createWithSchema(e,r))}if(2===t.length){var r=t;let[e,i]=r;return E.create(D.create(i),q.create(e))}throw Error(`invalid column reference ${e}`)}function t5(e){let t=" as ";if(!e.includes(t))return t8(e);{let[i,r]=e.split(t).map(t7);return v.create(t8(i),a.IdentifierNode.create(r))}}function t4(e){return D.create(e)}function t2(e){if(!e.includes(" "))return t4(e);{let[t,i]=e.split(" ").map(t7);if(!el(i))throw Error(`invalid order direction "${i}" next to "${t}"`);return ec([t,i])[0]}}function t7(e){return e.trim()}class t3{#m;constructor(e){this.#m=(0,d.freeze)(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new it(this,e)}$castTo(){return new t3({...this.#m})}$notNull(){return new t3(this.#m)}withPlugin(e){return new t3({...this.#m,plugins:void 0!==this.#m.plugins?(0,d.freeze)([...this.#m.plugins,e]):(0,d.freeze)([e])})}toOperationNode(){return this.#L(this.#A())}compile(e){return this.#R(this.#A(e))}async execute(e){let t=this.#A(e);return t.executeQuery(this.#R(t))}#A(e){let t=void 0!==e?e.getExecutor():ta;return void 0!==this.#m.plugins?t.withPlugins(this.#m.plugins):t}#L(e){return e.transformQuery(this.#m.rawNode,this.#m.queryId)}#R(e){return e.compileQuery(this.#L(e),this.#m.queryId)}}function ie(e){return new t3(e)}class it{#D;#g;constructor(e,t){this.#D=e,this.#g=t}get expression(){return this.#D}get alias(){return this.#g}get rawBuilder(){return this.#D}toOperationNode(){return v.create(this.#D.toOperationNode(),L(this.#g)?this.#g.toOperationNode():a.IdentifierNode.create(this.#g))}}let ii=Object.assign((e,...t)=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.create(e,t?.map(ir)??[])}),{ref:e=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithChild(t8(e))}),val:e=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithChild(j(e))}),value(e){return this.val(e)},table:e=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithChild(ez(e))}),id(...e){let t=Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.create(t,e.map(a.IdentifierNode.create))})},lit:e=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithChild(R.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithSql(e)}),join(e,t=ii`, `){let i=Array(Math.max(2*e.length-1,0)),r=t.toOperationNode();for(let t=0;t<e.length;++t)i[2*t]=ir(e[t]),t!==e.length-1&&(i[2*t+1]=r);return ie({queryId:(0,e7.createQueryId)(),rawNode:A.RawNode.createWithChildren(i)})}});function ir(e){return L(e)?e.toOperationNode():j(e)}}];

//# sourceMappingURL=node_modules_kysely_dist_esm_f84b3e75._.js.map