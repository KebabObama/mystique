{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/mystique/hooks/use-socket.ts"],"sourcesContent":["/**\n * Zustand store for Socket.IO connection and real-time communication\n * Uses callbacks to avoid dependency issues in useEffect\n *\n * @example\n * ```tsx\n * import { useSocket } from \"@/hooks/use-socket\";\n *\n * function MyComponent() {\n *   const connected = useSocket((state) => state.connected);\n *   const friendships = useSocket((state) => state.friendships);\n *   const connect = useSocket((state) => state.connect);\n *   const join = useSocket((state) => state.join);\n *   const selectFriendships = useSocket((state) => state.selectFriendships);\n *   const disconnect = useSocket((state) => state.disconnect);\n *\n *   const userId = \"user-id-here\";\n *\n *   useEffect(() => {\n *     connect();\n *     join(userId);\n *     selectFriendships(userId);\n *\n *     return () => disconnect();\n *   }, [connect, join, selectFriendships, disconnect, userId]);\n *\n *   return <div>Connected: {connected ? \"Yes\" : \"No\"}</div>;\n * }\n * ```\n */\n\"use client\";\n\nimport { io, type Socket } from \"socket.io-client\";\nimport { create } from \"zustand\";\nimport type { CRUD } from \"@/lib/friendship\";\n\n// Types for socket events\ntype FriendshipData = {\n\tfriendshipId: string;\n\tstate: number;\n\tsender: {\n\t\tid: string;\n\t\tname: string;\n\t\temail: string;\n\t\timage: string | null;\n\t};\n\treceiver: {\n\t\tid: string;\n\t\tname: string;\n\t\temail: string;\n\t\timage: string | null;\n\t};\n};\n\ntype Message = Awaited<ReturnType<typeof CRUD.message.getAll>>[number];\ntype MessageInsert = CRUD.message.Insert;\n\ninterface SocketState {\n\tsocket: Socket | null;\n\tconnected: boolean;\n\tfriendships: FriendshipData[];\n\tmessages: Message[];\n\n\t// Connection methods\n\tconnect: () => void;\n\tdisconnect: () => void;\n\n\t// User methods\n\tjoin: (userId: string) => void;\n\n\t// Friendship methods\n\tselectFriendships: (userId: string) => void;\n\tsendFriendship: (sender: string, receiver: string) => void;\n\tstateFriendship: (\n\t\tfriendship: { id: string; sender: string },\n\t\tstate: number,\n\t) => void;\n\n\t// Message methods\n\tselectMessages: (userId: string) => void;\n\tsendMessage: (msg: MessageInsert) => void;\n}\n\nlet socketInstance: Socket | null = null;\n\nexport const useSocket = create<SocketState>((set, _get) => ({\n\tsocket: null,\n\tconnected: false,\n\tfriendships: [],\n\tmessages: [],\n\n\tconnect: () => {\n\t\tif (socketInstance?.connected) return;\n\n\t\tsocketInstance = io(process.env.NEXT_PUBLIC_SOCKET_URL as string, {\n\t\t\ttransports: [\"websocket\"],\n\t\t\tautoConnect: true,\n\t\t});\n\n\t\t// Connection event handlers\n\t\tsocketInstance.on(\"connect\", () => {\n\t\t\tconsole.log(\"Socket connected\");\n\t\t\tset({ connected: true, socket: socketInstance });\n\t\t});\n\n\t\tsocketInstance.on(\"disconnect\", () => {\n\t\t\tconsole.log(\"Socket disconnected\");\n\t\t\tset({ connected: false });\n\t\t});\n\n\t\tsocketInstance.on(\"connect_error\", (error) => {\n\t\t\tconsole.error(\"Socket connection error:\", error);\n\t\t\tset({ connected: false });\n\t\t});\n\n\t\t// Friendship event handlers\n\t\tsocketInstance.on(\"get-friendships\", (friendships: FriendshipData[]) => {\n\t\t\tconsole.log(\"Received friendships:\", friendships);\n\t\t\tset({ friendships });\n\t\t});\n\n\t\t// Message event handlers\n\t\tsocketInstance.on(\"get-messages\", (messages: Message[]) => {\n\t\t\tconsole.log(\"Received messages:\", messages);\n\t\t\tset({ messages });\n\t\t});\n\n\t\tsocketInstance.on(\"receive-message\", (message: Message) => {\n\t\t\tconsole.log(\"Received new message:\", message);\n\t\t\tset((state) => ({\n\t\t\t\tmessages: [...state.messages, message],\n\t\t\t}));\n\t\t});\n\n\t\tset({ socket: socketInstance });\n\t},\n\n\tdisconnect: () => {\n\t\tif (socketInstance) {\n\t\t\tsocketInstance.disconnect();\n\t\t\tsocketInstance = null;\n\t\t\tset({ socket: null, connected: false });\n\t\t}\n\t},\n\n\tjoin: (userId: string) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Joining user room:\", userId);\n\t\t\tsocketInstance.emit(\"join\", userId);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot join room.\");\n\t\t}\n\t},\n\n\tselectFriendships: (userId: string) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Selecting friendships for user:\", userId);\n\t\t\tsocketInstance.emit(\"select-friendships\", userId);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot select friendships.\");\n\t\t}\n\t},\n\n\tsendFriendship: (sender: string, receiver: string) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Sending friendship request:\", { sender, receiver });\n\t\t\tsocketInstance.emit(\"send-friendships\", sender, receiver);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot send friendship.\");\n\t\t}\n\t},\n\n\tstateFriendship: (\n\t\tfriendship: { id: string; sender: string },\n\t\tstate: number,\n\t) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Updating friendship state:\", { friendship, state });\n\t\t\tsocketInstance.emit(\"state-friendship\", friendship, state);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot update friendship state.\");\n\t\t}\n\t},\n\n\tselectMessages: (userId: string) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Selecting messages for user:\", userId);\n\t\t\tsocketInstance.emit(\"select-messages\", userId);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot select messages.\");\n\t\t}\n\t},\n\n\tsendMessage: (msg: MessageInsert) => {\n\t\tif (socketInstance?.connected) {\n\t\t\tconsole.log(\"Sending message:\", msg);\n\t\t\tsocketInstance.emit(\"send-message\", msg);\n\t\t} else {\n\t\t\tconsole.warn(\"Socket not connected. Cannot send message.\");\n\t\t}\n\t},\n}));\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6BC;;;;AAGD;AACA;AAHA;;;AAqDA,IAAI,iBAAgC;AAE7B,MAAM,YAAY,IAAA,kJAAM,EAAc,CAAC,KAAK,OAAS,CAAC;QAC5D,QAAQ;QACR,WAAW;QACX,aAAa,EAAE;QACf,UAAU,EAAE;QAEZ,SAAS;YACR,IAAI,gBAAgB,WAAW;YAE/B,iBAAiB,IAAA,8LAAE,6DAA+C;gBACjE,YAAY;oBAAC;iBAAY;gBACzB,aAAa;YACd;YAEA,4BAA4B;YAC5B,eAAe,EAAE,CAAC,WAAW;gBAC5B,QAAQ,GAAG,CAAC;gBACZ,IAAI;oBAAE,WAAW;oBAAM,QAAQ;gBAAe;YAC/C;YAEA,eAAe,EAAE,CAAC,cAAc;gBAC/B,QAAQ,GAAG,CAAC;gBACZ,IAAI;oBAAE,WAAW;gBAAM;YACxB;YAEA,eAAe,EAAE,CAAC,iBAAiB,CAAC;gBACnC,QAAQ,KAAK,CAAC,4BAA4B;gBAC1C,IAAI;oBAAE,WAAW;gBAAM;YACxB;YAEA,4BAA4B;YAC5B,eAAe,EAAE,CAAC,mBAAmB,CAAC;gBACrC,QAAQ,GAAG,CAAC,yBAAyB;gBACrC,IAAI;oBAAE;gBAAY;YACnB;YAEA,yBAAyB;YACzB,eAAe,EAAE,CAAC,gBAAgB,CAAC;gBAClC,QAAQ,GAAG,CAAC,sBAAsB;gBAClC,IAAI;oBAAE;gBAAS;YAChB;YAEA,eAAe,EAAE,CAAC,mBAAmB,CAAC;gBACrC,QAAQ,GAAG,CAAC,yBAAyB;gBACrC,IAAI,CAAC,QAAU,CAAC;wBACf,UAAU;+BAAI,MAAM,QAAQ;4BAAE;yBAAQ;oBACvC,CAAC;YACF;YAEA,IAAI;gBAAE,QAAQ;YAAe;QAC9B;QAEA,YAAY;YACX,IAAI,gBAAgB;gBACnB,eAAe,UAAU;gBACzB,iBAAiB;gBACjB,IAAI;oBAAE,QAAQ;oBAAM,WAAW;gBAAM;YACtC;QACD;QAEA,MAAM,CAAC;YACN,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,sBAAsB;gBAClC,eAAe,IAAI,CAAC,QAAQ;YAC7B,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;QAEA,mBAAmB,CAAC;YACnB,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,mCAAmC;gBAC/C,eAAe,IAAI,CAAC,sBAAsB;YAC3C,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;QAEA,gBAAgB,CAAC,QAAgB;YAChC,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,+BAA+B;oBAAE;oBAAQ;gBAAS;gBAC9D,eAAe,IAAI,CAAC,oBAAoB,QAAQ;YACjD,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;QAEA,iBAAiB,CAChB,YACA;YAEA,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,8BAA8B;oBAAE;oBAAY;gBAAM;gBAC9D,eAAe,IAAI,CAAC,oBAAoB,YAAY;YACrD,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;QAEA,gBAAgB,CAAC;YAChB,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,gCAAgC;gBAC5C,eAAe,IAAI,CAAC,mBAAmB;YACxC,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;QAEA,aAAa,CAAC;YACb,IAAI,gBAAgB,WAAW;gBAC9B,QAAQ,GAAG,CAAC,oBAAoB;gBAChC,eAAe,IAAI,CAAC,gBAAgB;YACrC,OAAO;gBACN,QAAQ,IAAI,CAAC;YACd;QACD;IACD,CAAC","debugId":null}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/mystique/app/%28layout%29/%28wrapper%29/friends/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { useSocket } from \"@/hooks/use-socket\";\nimport { authClient } from \"@/lib/auth-client\";\n\nexport default () => {\n\tconst connected = useSocket((state) => state.connected);\n\tconst friendships = useSocket((state) => state.friendships);\n\tconst connect = useSocket((state) => state.connect);\n\tconst join = useSocket((state) => state.join);\n\tconst selectFriendships = useSocket((state) => state.selectFriendships);\n\tconst disconnect = useSocket((state) => state.disconnect);\n\n\tconst { data } = authClient.useSession();\n\n\tReact.useEffect(() => {\n\t\tif (!data) return;\n\t\tconnect();\n\t\tjoin(data.user.id);\n\t\tselectFriendships(data.user.id);\n    console.log(friendships)\n\n\t\treturn () => disconnect();\n\t}, [connect, join, selectFriendships, disconnect, data, friendships]);\n\n\treturn <div>Connected: {connected ? \"Yes\" : \"No\"}</div>;\n};\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;uCAMe;IACd,MAAM,YAAY,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,SAAS;IACtD,MAAM,cAAc,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,WAAW;IAC1D,MAAM,UAAU,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,OAAO;IAClD,MAAM,OAAO,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,IAAI;IAC5C,MAAM,oBAAoB,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,iBAAiB;IACtE,MAAM,aAAa,IAAA,mIAAS,EAAC,CAAC,QAAU,MAAM,UAAU;IAExD,MAAM,EAAE,IAAI,EAAE,GAAG,mIAAU,CAAC,UAAU;IAEtC,gNAAK,CAAC,SAAS,CAAC;QACf,IAAI,CAAC,MAAM;QACX;QACA,KAAK,KAAK,IAAI,CAAC,EAAE;QACjB,kBAAkB,KAAK,IAAI,CAAC,EAAE;QAC5B,QAAQ,GAAG,CAAC;QAEd,OAAO,IAAM;IACd,GAAG;QAAC;QAAS;QAAM;QAAmB;QAAY;QAAM;KAAY;IAEpE,qBAAO,8OAAC;;YAAI;YAAY,YAAY,QAAQ;;;;;;;AAC7C","debugId":null}}]
}